eBookCore.plugins.memo=function(_currentPageNum){if(0<$("#ebookmemo").length){$("#ebookmemo").detach();$("#ebookmemoExpansion").detach()}var memoEl=$("<div id='ebookmemo'>");memoEl.appendTo(document.body);$('<div id="ebookmemoBlind" class="blind" />'+'<div id="ebookmemoWnd">'+'<div				id="ebookmemoHeader"><span>'+eBookCore.getString("memo")+'</span></div>'+'<img				id="ebookmemoMinimization"	class="ebookmemominBtn" tabindex="1" src="'+eBookCore.resource.minimization+'" alt="'+eBookCore.getString("minimization")+'"/>'+'<img				id="ebookmemoClose"	class="ebookmemoBtn" tabindex="0" src="'+eBookCore.resource.close+'" alt="'+eBookCore.getString("close")+'"/>'+'<ul				id="ebookmemoList" />'+'<textarea	id="ebookmemoInput"		placeholder="'+eBookCore.getString("writehere")+'" />'+'</div>').appendTo(memoEl);var memoEx=$('<div id="ebookmemoExpansion"><img	id="ebookmemoExpansionimg"	class="ebookmemoxpansionBtn; tabindex="1" src="'+eBookCore.resource.memoexpansion+'" alt="'+eBookCore.getString("memoexpansion")+'" /></div>');memoEx.appendTo(document.body);var _cookieHeader="ebookmemo";var memoList=memoEl.find("#ebookmemoList");var inputArea=memoEl.find("#ebookmemoInput");$('#ebookmemoWnd').draggable({handle:"#ebookmemoHeader",opacity:0.9,cancel:"#ebookmemoList, .ebookmemominBtn, .ebookmemoBtn"});var memoData=eBookCore.func.getCookie(_cookieHeader);if(!memoData){memoData={}}for(var i=1;i<=eBookData.totalPageNum;++i){var addEl=$("<li tabindex='0' page='"+i+"'/>").text(i).on(eBookCore.eventType.keyclick,function(e){var oldSel=memoList.find(".selected");oldSel.removeClass("selected");var newSel=$(e.target);newSel.addClass("selected");var _num=parseInt(newSel.attr("page"));inputArea.val(memoData[_num])});if(memoData[i]){addEl.addClass("saved").text("\u2709"+addEl.attr("page"))}if(i==_currentPageNum){addEl.addClass("selected")}memoList.append(addEl)}if(memoData[_currentPageNum]){inputArea.val(memoData[_currentPageNum])}inputArea.on("change",function(){var selEl=memoList.find(".selected");var _num=parseInt(selEl.attr("page"));if(!memoData[_num]&&inputArea.val().length){selEl.addClass("saved").text("\u2709"+selEl.attr("page"))}else if(memoData[_num]&&!inputArea.val().length){selEl.removeClass("saved");selEl.text(selEl.attr("page"))}memoData[_num]=inputArea.val()});memoEl.find('#ebookmemoClose').on(eBookCore.eventType.keyclick,function(e){if(!eBookCore.eventType.isExcute(e)){return}eBookCore.func.setCookie(_cookieHeader,memoData);$("#ebookmemo").detach();$("#ebookmemoExpansion").detach()});memoEl.find('#ebookmemoMinimization').on(eBookCore.eventType.keyclick,function(e){if(!eBookCore.eventType.isExcute(e)){return}eBookCore.func.setCookie(_cookieHeader,memoData);$('#ebookmemoWnd').fadeOut();$('#ebookmemoExpansion').fadeIn();$('#ebookmemoExpansion').draggable()});$('#ebookmemoExpansionimg').on(eBookCore.eventType.keyclick,function(e){if(!eBookCore.eventType.isExcute(e)){return}$('#ebookmemoExpansion').fadeOut();$('#ebookmemoWnd').fadeIn()});inputArea.focus();var _sel=memoList.find(".selected");memoList.scrollTop(memoList.scrollTop()+_sel.position().top-(memoList.height()-_sel.height())/2)};