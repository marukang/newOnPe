eBookCore.plugins.printView={open:function(){},update:function(){}};eBookCore.plugins.printView.open=function(_pageUrl,_pageExt,_currentPageNum,_totalPageNum){_pageExt='jpg';var printViewEl=$("<div id='ebookprintview' class='blind' />");printViewEl.append($("<h1 id='printHeader' >"+eBookCore.getString("printPreview")+"</h1>"));printViewEl.append($("<span id='printCloseBtn' />"));printViewEl.append($("<div id='printPreview' />").html("<div id='printPreviewContents' />"));var printOptForm=$("<form id='printOptions' ></form>");printOptForm.append("<span id='print_title_range'>"+eBookCore.getString("printRange")+"</span><br/>"+"<ul><li>"+"<input name='pageExt' type='radio' id='printPageJpg'  value='jpg' checked='checked' />"+"<label for='printPageJpg'>"+eBookCore.getString("printPageJpg")+"</label> , "+"<input name='pageExt' type='radio' id='printPageSvg'  value='svg' />"+"<label for='printPageSvg'>"+eBookCore.getString("printPageSvg")+"</label>"+"</li><li>"+"<input name='pageRange' type='radio' id='printPageCurr'  value='current' checked=''checked' />"+"<label for='printPageCurr'>"+eBookCore.getString("currentPage")+"<select id='print_page_now' dir='rtl' /></label>"+"</li><li>"+"<input name='pageRange' type='radio' id='printPageRange' value='range' />"+"<label for='printPageRange'>"+eBookCore.getString("selectRange")+"</label>"+"<div style='text-indent:1.5em; '>"+"	<select id='print_page_st' dir='rtl' disabled/>"+"<span> ~ </span>"+"<select id='print_page_ed' dir='rtl' disabled/>"+"</div>"+"</li><li>"+"<input name='pageRange'	type='radio' id='printPageAll' value='all' />"+"<label for='printPageAll'>"+eBookCore.getString("allPages")+"</label>"+"</li></ul>"+"<input id='print_ok'			type='button' value='"+eBookCore.getString("print")+"' />"+"<input id='print_close'	type='button' value='"+eBookCore.getString("close")+"' />");printViewEl.append(printOptForm);printViewEl.appendTo(document.body);printViewEl.focus();var selPageNums='';for(var i=1;i<=_totalPageNum;++i){selPageNums+="<option>"+i+"</option>"}$("#print_page_st").append(selPageNums);$("#print_page_ed").append(selPageNums);$("#print_page_now").append(selPageNums);$("#print_page_now").val(_currentPageNum).attr("selected","selected");$("input[name='pageRange']").on("change",function(e){if($(e.target).val()==='range'){$("#print_page_st").removeAttr("disabled");$("#print_page_ed").removeAttr("disabled");$("#print_page_now").attr("disabled","")}else if($(e.target).val()==='current'){$("#print_page_st").attr("disabled","");$("#print_page_ed").attr("disabled","");$("#print_page_now").removeAttr("disabled")}else{$("#print_page_st").attr("disabled","");$("#print_page_ed").attr("disabled","");$("#print_page_now").attr("disabled","")}eBookCore.plugins.printView.update(_pageUrl,_pageExt,_currentPageNum,_totalPageNum)});$("input[name='pageExt']").on("change",function(e){if($(e.target).val()==='svg'){_pageExt='svg';alert(eBookCore.getString("printPageAlert"))}else{_pageExt='jpg'}eBookCore.plugins.printView.update(_pageUrl,_pageExt,_currentPageNum,_totalPageNum)});$("#printOptions select").on("change",function(e){var _stNum=parseInt($("#print_page_st option:selected").val());var _edNum=parseInt($("#print_page_ed option:selected").val());if(_stNum>_edNum){if($("#print_page_st ").is(e.target)){$(e.target).val(_edNum)}else{$(e.target).val(_stNum)}}eBookCore.plugins.printView.update(_pageUrl,_pageExt,_currentPageNum,_totalPageNum)});$("#print_ok").on("click",function(){$("#printPreviewContents").print({globalStyles:true,mediaPrint:true,stylesheet:null,iframe:false,manuallyCopyFormValues:false,})});$("#print_close").on("click",function(){$("#ebookprintview").detach()});$("#printCloseBtn").on("click",function(){$("#ebookprintview").detach()});eBookCore.plugins.printView.update(_pageUrl,_pageExt,_currentPageNum,_totalPageNum)};eBookCore.plugins.printView.update=function(_pageUrl,_pageExt,_currentPageNum,_totalPageNum){var pageNums=[],_rangeType=$("#ebookprintview input[name='pageRange']:checked").val(),_stNum=1,_edNum=_totalPageNum;switch(_rangeType){case'current':_stNum=_edNum=parseInt($("#print_page_now :selected").val());break;case'range':_stNum=parseInt($("#print_page_st :selected").val());_edNum=parseInt($("#print_page_ed :selected").val());break;case'all':break}var _previewWnd=$("#printPreviewContents");_previewWnd.children().detach();for(var i=_stNum;i<=_edNum;++i){_previewWnd.append("<img src='"+_pageUrl+i+"."+_pageExt+"' />")}$('#printPreviewContents img').each(function(n){$(this).error(function(){var pfile=$(this).attr('src').split('/');var pfilename=pfile[pfile.length-1];$(this).attr('src',_pageUrl+pfilename.replace('.svg','.jpg'))})})};