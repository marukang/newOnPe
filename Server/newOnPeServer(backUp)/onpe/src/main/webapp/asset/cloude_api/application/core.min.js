var eBookCore={currentPageNum:null,pageOrigWidth:0,pageOrigHeight:0,thumbRatio:1,path:{},eventType:{},searchCountMax:10,keyDownState:[],func:{}},eFnc=eBookCore.func;eBookCore.pageTurn={init:function(){croTools.log("not defined : eBookCore.pageTurn.init")},update:function(e){croTools.log("not defined : eBookCore.pageTurn.update")},getVisiblePageNumbers:function(){return croTools.log("not defined : eBookCore.pageTurn.getVisiblePageNumbers"),null},addBookmarkToPage:function(e,o){croTools.log("not defined : eBookCore.pageTurn.addBookmarkToPage")},getZoomRatio:function(){return croTools.log("not defined : eBookCore.pageTurn.getZoomRatio"),1}},eBookCore.plugins={},eBookCore.components={data:[],action:function(){croTools.log("not defined : eBookCore.components.action")},video:function(){croTools.log("not defined : eBookCore.components.video")},youtube:function(){croTools.log("not defined : eBookCore.components.youtube")},audio:function(){croTools.log("not defined : eBookCore.components.audio")},image:function(){croTools.log("not defined : eBookCore.components.image")},imageSlider:function(){croTools.log("not defined : eBookCore.components.imageSlider")},text:function(){croTools.log("not defined : eBookCore.components.text")},link:function(){croTools.log("not defined : eBookCore.components.link")},resizing:function(e){e=$(e);var o=eBookCore.components.data[e.attr("id")],t=eBookCore.pageTurn.getZoomRatio("w"),n=eBookCore.pageTurn.getZoomRatio("h");if("false"===o.visible&&e.css("visibility","hidden"),0<e.closest(".mejs-container").length)return e.css({width:t*parseInt(o.width)+"px",height:n*parseInt(o.height)+"px"}),void(e=e.closest(".mejs-container")).css({left:t*parseInt(o.x)+"px",top:n*parseInt(o.y)+"px",width:t*parseInt(o.width)+"px",height:n*parseInt(o.height)+"px"});e.css({left:t*parseInt(o.x)+"px",top:n*parseInt(o.y)+"px",width:t*parseInt(o.width)+"px",height:n*parseInt(o.height)+"px"}),isNaN(o.textHeight)||e.css("font-size",n*parseInt(o.textHeight)+"px")},setActionEvent:function(e){var t,n,a=eBookCore.components.data[$(e).attr("id")];if("toggleVisible"!==a.action)return croTools.log("unexpected action type : "+a.action);if("onRelease"!==a.event)return croTools.log("unexpected event type : "+a.event);1!=eBookData.pagearea&&0!=eBookData.pagearea||(n="ver_CC");var r=function(e){var o=$("#"+e);if(!(o.length<1))return t=o[0].tagName,"VIDEO"===o[0].tagName||"AUDIO"===o[0].tagName?o.closest(".mejs-container"):o},o=r(a.dispatcher);if(!o)return croTools.log("action dispatcher not found : "+a.dispatcher);o.on("click",function(e){croTools.log("action toggle");var o=r(a.target);if(!o)return croTools.log("action target not found : "+a.target);"AUDIO"==t?"ver_CC"!=n?o.css("visibility","hidden"==o.css("visibility")?"visible":"hidden"):audioFactory.getById(a.target).togglePlay():o.css("visibility","hidden"==o.css("visibility")?"visible":"hidden")})},setLinkEvent:function(e){$(e).hover(function(e){var o=eBookCore.components.data[$(e.target).attr("id")];$(e.target).css("background-color",croTools.hexToRGBA(o.rolloverColor.substr(0,8).replace("0x","#"),o.rolloverColor.substr(9)))},function(e){var o=eBookCore.components.data[$(e.target).attr("id")];$(e.target).css("background-color",croTools.hexToRGBA(o.backgroundColor.substr(0,8).replace("0x","#"),o.backgroundColor.substr(9)))}),$(e).off("click"),$(e).on("click",eBookCore.components.openLinkByData)},openLinkByData:function(e){var o;switch((o=void 0===$(e.target).attr("id")||0==$(e.target).attr("id").length?$(e.target).attr("data-link").split("|"):eBookCore.components.data[$(e.target).attr("id")].link.split("|"))[0]){case"address":7<o[2].length&&window.open(o[2],o[1]);break;case"popup":var t=o[6].split("(_-__-_)")[0];7<t.length&&window.open(t,o[0],"left="+o[1]+", top="+o[2]+", width="+o[3]+", height="+o[4]);break;case"page":eBookCore.func.gotoPage(parseInt(o[1]));break;default:croTools.log("unknown link type : "+o[0])}},setTextEvent:function(e){$(e).off("click"),$(e).on("click",eBookCore.components.openLinkByData)},setImageEvent:function(e){$(e).off("click"),$(e).on("click",eBookCore.components.openLinkByData)},createMediaPlayer:function(e){(e=$(e)).mediaelementplayer({startVolume:1,loop:!1,enableAutosize:!0,features:["playpause","progress","current","duration","fullscreen"],alwaysShowControls:!1,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,alwaysShowHours:!1,showTimecodeFrameCount:!1,framesPerSecond:25,enableKeyboard:!1,pauseOtherPlayers:!1,keyActions:[],success:function(e,o,t){"iframe"===$(o).prop("tagName").toLowerCase()&&$(o).attr("title").toLowerCase()==="YouTube video player".toLowerCase()&&$(o).siblings().prop("tagName").toLowerCase()==="video".toLowerCase()&&$(o).siblings().attr("type").toLowerCase()==="video/youtube".toLowerCase()&&$(o).css({width:$(o).siblings().css("width"),height:$(o).siblings().css("height")})}});var o=e.closest(".mejs-container");if(o.length<1&&(o=(e=$("#"+e.attr("id"))).closest(".mejs-container")).length<1)return croTools.log("createMediaPlayer : media container not found.");o.attr("style",e.attr("style")).css("position","absolute");var t=eBookCore.components.data[e.attr("id")];if(t.normalImage&&0<t.normalImage.length){var n=eBookCore.path.contents+t.normalImage;o.find(".mejs-overlay-play").append("<img src='"+n+"' title='play button image' style='width:100%;height:100%' />")}if(e.attr({width:"",height:""}).css({left:"",top:"",visibility:""}),!croTools.isMobile()&&"VIDEO"!==e[0].tagName&&"true"===eBookCore.getDataById(e[0].id).autoplay){var a=eBookCore.getPageNumById(e.attr("id")),r=eBookCore.pageTurn.getVisiblePageNumbers();if(!r)return croTools.log("failed : getVisiblePageNumbers");for(var i=0;i<r.length;++i)r[i]===a&&(croTools.log("autoplay : "+a+" / "+e.get(0)),e.get(0).play())}},calcDimensions:function(e){e=$(e);var o=eBookCore.components.data[e.attr("id")];"run"!==$("#"+o.id+"_").attr("data-status")&&($("#"+o.id).css({"max-width":$("#"+o.id).css("width")}),$("#"+o.id+"_").children("li").children("img").css({width:$("#"+o.id).css("width"),height:$("#"+o.id).css("height")}))},loadSlider:function(e){e=$(e);var o=eBookCore.components.data[e.attr("id")];if("run"!==$("#"+o.id+"_").attr("data-status"))$("#"+o.id+"_").lightSlider({gallery:!1,item:1,slideMargin:0,speed:1e3,pause:4e3,auto:"false"!==o.visible,loop:!0,pauseOnHover:!0,enableDrag:!1,controls:!1,pager:!0,onSliderLoad:function(e){$("#"+o.id+"_").removeClass("cS-hidden"),$("#"+o.id+"_").addClass("lsGrab"),$("#"+o.id+"_").attr({"data-status":"run"}),eBookCore.components.isThisCurrentPage($("#"+o.id+"_").attr("data-page"))&&eBookCore.components.forceRefresh()}});else if(eBookCore.components.isThisCurrentPage($("#"+o.id+"_").attr("data-page")))try{var t=eBookCore.components.nowTime(),n=eBookCore.components.elapsedTime($("#"+o.id+"_").attr("data-refresh"),t);500<parseInt(n)&&eBookCore.components.forceRefresh(),$("#"+o.id+"_").attr({"data-refresh":t})}catch(e){console.log(e.message)}},unloadSlider:function(e){console.log("do something")},isThisCurrentPage:function(e){for(var o=eBookCore.pageTurn.getVisiblePageNumbers(),t=0;t<o.length;++t)if(parseInt(o[t])===parseInt(e))return!0;return!1},forceRefresh:function(){if(eBookCore.components.isIe()){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!0),window.dispatchEvent(e),eBookCore.pageTurn.getVisiblePageNumbers()%2!=0&&window.dispatchEvent(e)}else window.dispatchEvent(new Event("resize")),eBookCore.pageTurn.getVisiblePageNumbers()%2!=0&&window.dispatchEvent(new Event("resize"))},nowTime:function(){return(new Date).getTime()},elapsedTime:function(e,o){return o-e},isIe:function(){var e=window.navigator.userAgent,o=e.indexOf("MSIE "),t=e.indexOf("Trident/");return 0<o||0<t}},eBookCore.string={search:{en:"search",ko:"검색",ja:"檢索",zh:"檢索"},input_here:{en:"input here",ko:"여기에 입력",ja:"ここに入力",zh:"在这里输入"},result:{en:"result",ko:"결과",ja:"結果",zh:"結果"},search_more:{en:"▼more▼",ko:"▼더 보기▼",ja:"次へ",zh:"下一次"},contents:{en:"contents",ko:"목차",ja:"目次",zh:"目次"},bookmark:{en:"bookmark",ko:"책갈피",ja:"ブックマーク",zh:"书签"},unusable:{en:"unusable",ko:"사용 불가",ja:"使用不可",zh:"不可用"},first_page:{en:"first page",ko:"첫 페이지",ja:"最初のページ",zh:"第一页"},last_page:{en:"last page",ko:"끝 페이지",ja:"最後のページ",zh:"最后一页"},memo:{en:"memo",ko:"메모",ja:"メモ",zh:"记录"},writehere:{en:"write here",ko:"여기에 작성",ja:"ここに作成",zh:"写在这里"},save:{en:"save",ko:"저장",ja:"保存",zh:"保存"},cancel:{en:"cancel",ko:"취소",ja:"キャンセル",zh:"取消"},close:{en:"close",ko:"닫기",ja:"閉じる",zh:"关闭"},minimization:{en:"minimization",ko:"최소화",ja:"最小化",zh:"最小化"},memoexpansion:{en:"expansion",ko:"최대화",ja:"最大化",zh:"最大化"},print:{en:"print",ko:"인쇄",ja:"プリント",zh:"印刷"},printPreview:{en:"print preview",ko:"인쇄 미리보기",ja:"プレビュー",zh:"预览"},printRange:{en:"print range",ko:"인쇄 범위",ja:"範囲",zh:"範圍"},currentPage:{en:"current page",ko:"현재 페이지",ja:"現在ページ",zh:"当前页"},selectRange:{en:"select range",ko:"범위 지정",ja:"範囲指定",zh:"指定范围"},allPages:{en:"all pages",ko:"전체 페이지",ja:"全体ページ",zh:"整个页面"},printPageJpg:{en:"Normal",ko:"일반화질",ja:"一般画質",zh:"正常"},printPageSvg:{en:"high",ko:"고화질",ja:"高画質",zh:"高清"},printPageAlert:{en:"high quality printing may not print entire pages, depending on computer specifications.\n(PC memory 16GB or higher recommended / 1page printable)",ko:"고화질 인쇄시, 컴퓨터 사양에 따라 전체 페이지가 인쇄 되지 않을 수 있습니다.\n(PC 메모리 16GB 이상 권장/ 이하의 경우 1page씩 인쇄 가능)",ja:"高画質 印刷時に、コンピュータの仕様に応じてページ全体が印刷されないことがあります.\n(PCメモリ16GB以上を推奨/以下の場合1pageずつ印刷可能)",zh:"当高品质的打印，根据您的计算机的规格，则无法打印整个页面。（如果电脑内存16GB或1/1比较推荐/打印更少）"},zoomIn:{en:"zoom in",ko:"확대",ja:"拡大",zh:"扩大"},zoomOut:{en:"zoom out",ko:"축소",ja:"縮小",zh:"缩小"},undo:{en:"undo",ko:"실행취소",ja:"アンドゥ",zh:"撤消"},redo:{en:"redo",ko:"실행복구",ja:"リドゥ",zh:"重做"},clear:{en:"clear",ko:"초기화",ja:"初期化",zh:"初始化"},download:{en:"download",ko:"내려받기",ja:"ダウンロード",zh:"下载"},opacity:{en:"opacity",ko:"투명도",ja:"透明度",zh:"透明度"},pen:{en:"pen",ko:"펜",ja:"ペン",zh:"笔"},marker:{en:"marker",ko:"마커",ja:"マーカー",zh:"记号笔"},submit:{en:"submit",ko:"확인",ja:"確認",zh:"确认"},enter_pwd:{en:"Please enter your password",ko:"암호를 입력해 주세요",ja:"暗号を入力してください",zh:"请输入您的密码"},incorrect_pwd:{en:"You entered an incorrect password",ko:"틀린 암호를 입력하셨습니다",ja:"間違ったパスワードを入力しました",zh:"您输入的密码不正确"},sns_msg:{en:"I introduce my NexBook.",ko:"저의 NexBook을 소개합니다.",ja:"私のNexBookを紹介します",zh:"我介绍一下我的NexBook."}},eBookCore.getString=function(o){try{return eBookCore.string[o][croTools.getLang()]||eBookCore.string[o].en}catch(e){return croTools.log("getString( "+o+" ) error : "+e.message),"unexpected string : "+o}},eBookCore.getPageNumById=function(e){for(var o=eBookData.pageContents,t=0;t<o.length;++t)for(var n=1;n<o[t].length;++n){o[t][n];if(o[t][n].id===e)return o[t][0]}return croTools.log("not found page number : unknown id="+e)},eBookCore.getDataById=function(e){for(var o=eBookData.pageContents,t=0;t<o.length;++t)for(var n=1;n<o[t].length;++n){o[t][n];if(o[t][n].id===e)return o[t][n]}return croTools.log("not found data : unknown id="+e)};